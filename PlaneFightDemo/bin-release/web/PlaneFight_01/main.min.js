var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.createGameScene=function(){var e=this.createBitmapByName("bg1_png");this.addChild(e);var t=this.stage.stageWidth,i=this.stage.stageHeight;e.width=t,e.height=i,this.icon=this.createBitmapByName("plane2_png"),this.addChild(this.icon),this.icon.anchorOffsetX=this.icon.width/2,this.icon.anchorOffsetY=this.icon.height/2,this.icon.x=t/2,this.icon.y=4*i/5,this.icon.scaleX=this.icon.scaleY=.5,this.icon.touchEnabled=!0,this.icon.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startMove,this),this.icon.addEventListener(egret.TouchEvent.TOUCH_END,this.stopMove,this),this.bullets=new Array;var s=new Bullet;s.texture=RES.getRes("shot1_png"),this.addChild(s),this.bullets.push(s),console.log("icon.x:"+this.icon.x+"    icon.y:"+this.icon.y+"   icon.anchorOffsetX:"+this.icon.anchorOffsetX),s.x=this.icon.x-15,s.y=this.icon.y-75,console.log("bullet.x:"+s.x+"    bullet.y:"+s.y+"  bullet.width:"+s.width),this.addEventListener(egret.Event.ENTER_FRAME,this.bulletAdd,this),this.enemys=new Array;var n=new egret.Timer(100);n.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),n.start()},t.prototype.bulletAdd=function(){var e=new Bullet;e.texture=RES.getRes("shot1_png"),this.addChild(e),this.bullets.push(e),e.x=this.icon.x-1,e.y=this.icon.y-75;for(var t=this.bullets.length-1;t>-1;--t){var e=this.bullets[t],i=e.y-e.speed;0>i&&(this.removeChild(this.bullets[t]),this.bullets.splice(t,1)),e.y=i}},t.prototype.timerFunc=function(e){var t=e.target;if(t.currentCount%5==0&&t.currentCount<=150){var i=new Enemy;i.texture=RES.getRes("enemy1_png"),i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,this.addChild(i),this.enemys.push(i),i.x=Math.random()*this.stage.stageWidth,i.y=0,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.scaleX=i.scaleY=.5;var s=Math.random();i.speed=s>.3?30*s:15,console.log("计时"+t.currentCount)}for(var n=this.enemys.length-1;n>-1;--n){var i=this.enemys[n],o=i.y+i.speed;o>this.stage.stageHeight&&(this.removeChild(this.enemys[n]),this.enemys.splice(n,1)),i.y=o}this.hit(t),console.log(this.enemys.length+"    敌机数量"+t.currentCount+"    次数"),t.currentCount>150&&0==this.enemys.length&&(this.removeEventListener(egret.Event.ENTER_FRAME,this.bulletAdd,this),t.removeEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.bullets.length=0,this.addChild(this.createGameOver()))},t.prototype.hit=function(e){for(var t=0;t<this.bullets.length;t++)for(var i=this.bullets[t],s=0;s<this.enemys.length;s++){var n=this.enemys[s],o=this.hitTest(n,i)||this.hitTest(n,this.icon);o&&(this.hitTest(n,this.icon)&&(this.removeChild(this.icon),this.removeEventListener(egret.Event.ENTER_FRAME,this.bulletAdd,this),e.removeEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.bullets.length=0,this.addChild(this.createGameOver())),this.removeChild(i),this.removeChild(n),this.enemys.splice(s,1),this.bullets.splice(t,1),this.bomb(n))}},t.prototype.bomb=function(e){var t=this,i=this.createBitmapByName("bomb_png");i.x=e.x,i.y=e.y,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,this.addChild(i);var s=new egret.Timer(500,1);s.addEventListener(egret.TimerEvent.TIMER,function(){t.removeChild(i)},this),s.start()},t.prototype.hitTest=function(e,t){var i=e.hitTestPoint(t.x,t.y);return i},t.prototype.startMove=function(e){this.draggedObject=e.currentTarget,this.offsetX=e.stageX-this.draggedObject.x,this.offsetY=e.stageY-this.draggedObject.y,this.addChild(this.draggedObject),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this)},t.prototype.stopMove=function(e){this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this)},t.prototype.onMove=function(e){e.stageX>0&&e.stageX<this.stage.stageWidth&&e.stageY>0&&e.stageY<this.stage.stageHeight&&(this.draggedObject.x=e.stageX-this.offsetX,this.draggedObject.y=e.stageY-this.offsetY)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t.prototype.createGameOver=function(){var e=new egret.TextField;return e.text="游戏结束！",e.x=this.stage.stageWidth/2,e.y=this.stage.stageHeight/2,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Bullet=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.speed=40,t}return __extends(t,e),t}(egret.Bitmap);__reflect(Bullet.prototype,"Bullet");var Enemy=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.speed=10,t}return __extends(t,e),t}(egret.Bitmap);__reflect(Enemy.prototype,"Enemy");