var __reflect=this&&this.__reflect||function(e,t,s){e.__class__=t,s?s.push(t):s=[t],e.__types__=e.__types__?s.concat(e.__types__):s},__extends=this&&this.__extends||function(e,t){function s(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)},LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},t.prototype.createGameScene=function(){var e=this,t=this.createBitmapByName("bg1_png");this.addChild(t);var s=this.stage.stageWidth,i=this.stage.stageHeight;t.width=s,t.height=i,this.icon=this.createBitmapByName("plane2_png"),this.addChild(this.icon),this.icon.anchorOffsetX=this.icon.width/2,this.icon.anchorOffsetY=this.icon.height/2,this.icon.x=s/2,this.icon.y=4*i/5,this.icon.scaleX=this.icon.scaleY=.5,this.icon.touchEnabled=!0,this.icon.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startMove,this),this.icon.addEventListener(egret.TouchEvent.TOUCH_END,this.stopMove,this),this.bullets=new Array;var o=new Bullet;o.texture=RES.getRes("shot1_png"),this.addChild(o),this.bullets.push(o),console.log("icon.x:"+this.icon.x+"    icon.y:"+this.icon.y+"   icon.anchorOffsetX:"+this.icon.anchorOffsetX),o.x=this.icon.x-15,o.y=this.icon.y-75,console.log("bullet.x:"+o.x+"    bullet.y:"+o.y+"  bullet.width:"+o.width),this.addEventListener(egret.Event.ENTER_FRAME,function(){var t=new Bullet;t.texture=RES.getRes("shot1_png"),e.addChild(t),e.bullets.push(t),t.x=e.icon.x-15,t.y=e.icon.y-75;for(var s=e.bullets.length-1;s>-1;--s){var t=e.bullets[s],i=t.y-t.speed;0>i&&(e.removeChild(e.bullets[s]),e.bullets.splice(s,1)),t.y=i}},this),this.enemys=new Array;var n=new egret.Timer(100);n.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),n.start()},t.prototype.timerFunc=function(e){var t=e.target;if(t.currentCount%5==0&&t.currentCount<=150){var s=new Enemy;s.texture=RES.getRes("enemy1_png"),this.addChild(s),this.enemys.push(s),s.x=Math.random()*this.stage.stageWidth,s.y=0,s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height/2,s.scaleX=s.scaleY=.5;var i=Math.random();s.speed=i>.3?30*i:15,console.log("计时"+t.currentCount)}for(var o=this.enemys.length-1;o>-1;--o){var s=this.enemys[o],n=s.y+s.speed;n>this.stage.stageHeight&&(this.removeChild(this.enemys[o]),this.enemys.splice(o,1)),s.y=n}this.hit()},t.prototype.hit=function(){for(var e=0;e<this.bullets.length;e++)for(var t=this.bullets[e],s=0;s<this.enemys.length;s++){var i=this.enemys[s],o=this.hitTest(t,i);o&&(this.removeChild(t),this.removeChild(i),this.enemys.splice(s,1),this.bullets.splice(e,1),this.bomb(t))}},t.prototype.bomb=function(e){var t=this,s=this.createBitmapByName("bomb_png");s.x=e.x,s.y=e.y,this.addChild(s);var i=new egret.Timer(500,1);i.addEventListener(egret.TimerEvent.TIMER,function(){t.removeChild(s)},this),i.start()},t.prototype.hitTest=function(e,t){var s=e.getBounds(),i=t.getBounds();return s.x=e.x,s.y=e.y,i.x=t.x,i.y=t.y,s.intersects(i)},t.prototype.startMove=function(e){this.draggedObject=e.currentTarget,this.offsetX=e.stageX-this.draggedObject.x,this.offsetY=e.stageY-this.draggedObject.y,this.addChild(this.draggedObject),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this)},t.prototype.stopMove=function(e){this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this)},t.prototype.onMove=function(e){e.stageX>0&&e.stageX<this.stage.stageWidth&&e.stageY>0&&e.stageY<this.stage.stageHeight&&(this.draggedObject.x=e.stageX-this.offsetX,this.draggedObject.y=e.stageY-this.offsetY)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,s=RES.getRes(e);return t.texture=s,t},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Bullet=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.speed=40,t}return __extends(t,e),t}(egret.Bitmap);__reflect(Bullet.prototype,"Bullet");var Enemy=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.speed=10,t}return __extends(t,e),t}(egret.Bitmap);__reflect(Enemy.prototype,"Enemy");